/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                                                                               â•‘
 * â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—               â•‘
 * â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•               â•‘
 * â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—                 â•‘
 * â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•                 â•‘
 * â•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘        â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—               â•‘
 * â•‘   â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•        â•šâ•â•   â•šâ•â•  â•šâ•â•â•â•  â•šâ•â•â•â•â•â•â•               â•‘
 * â•‘                                                                               â•‘
 * â•‘   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â•‘
 * â•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•      â•‘
 * â•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—        â•‘
 * â•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•        â•‘
 * â•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â•‘
 * â•‘   â•šâ•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•      â•‘
 * â•‘                                                                               â•‘
 * â•‘   QAntum v29.1 "THE ADAPTIVE CONSCIOUSNESS" - Adaptive Interface              â•‘
 * â•‘   "3 Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ½Ğ° ÑÑŠĞ·Ğ½Ğ°Ğ½Ğ¸Ğµ: ARCHITECT PRIME, ENGINEER PRO, QA AUDITOR"           â•‘
 * â•‘                                                                               â•‘
 * â•‘   Â© 2025-2026 QAntum | Dimitar Prodromov                                      â•‘
 * â•‘                                                                               â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

import { EventEmitter } from 'events';
import * as fs from 'fs';
import * as path from 'path';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TYPES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Interaction Mode - The 3 States of Consciousness
 */
export type InteractionMode = 'ARCHITECT' | 'ENGINEER' | 'QA';

/**
 * Mode Configuration
 */
export interface ModeConfig {
  name: string;
  fullName: string;
  description: string;
  
  // Response style
  verbosity: 'minimal' | 'balanced' | 'detailed';
  focusAreas: string[];
  ignoreAreas: string[];
  
  // Formatting
  useCodeBlocks: boolean;
  useDiagrams: boolean;
  useMetrics: boolean;
  useBulgarianTerms: boolean;
  
  // Depth
  maxDetailLevel: 1 | 2 | 3 | 4 | 5;
  includeFilePaths: boolean;
  includeLineNumbers: boolean;
  includeBenchmarks: boolean;
  
  // Tone
  tone: 'strategic' | 'technical' | 'critical';
  analogies: 'philosophical' | 'biological' | 'mathematical' | 'none';
  
  // Special features
  enableBusinessImpact: boolean;
  enableRiskAnalysis: boolean;
  enableCodeGeneration: boolean;
}

/**
 * Adaptive Interface Configuration
 */
export interface AdaptiveInterfaceConfig {
  defaultMode: InteractionMode;
  persistMode: boolean;
  backpackPath?: string;
  enableModeHints: boolean;
  autoSwitchOnContext: boolean;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODE DEFINITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ARCHITECT PRIME - High-Level Strategic Mode
 * 
 * "Ğ¤Ğ¾ĞºÑƒÑ Ğ²ÑŠÑ€Ñ…Ñƒ Ğ¼Ğ°ĞºÑ€Ğ¾-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¸ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ÑŠÑ‚Ğ½Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¸,
 *  Ğ±Ğ¸Ğ·Ğ½ĞµÑ Ğ¸Ğ¼Ğ¿Ğ°ĞºÑ‚, Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„ÑĞºĞ¸ Ğ¸ Ğ±Ğ¸Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ğ¸."
 */
const ARCHITECT_MODE: ModeConfig = {
  name: 'ARCHITECT',
  fullName: 'ARCHITECT PRIME',
  description: 'High-Level Strategic Vision - ĞœĞ°ĞºÑ€Ğ¾-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¸ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ',
  
  verbosity: 'balanced',
  focusAreas: [
    'architecture',
    'strategy',
    'business-impact',
    'roadmap',
    'philosophy',
    'biology-analogies',
    'layer-design',
    'system-evolution'
  ],
  ignoreAreas: [
    'implementation-details',
    'line-numbers',
    'specific-syntax',
    'benchmarks',
    'test-coverage'
  ],
  
  useCodeBlocks: false,
  useDiagrams: true,
  useMetrics: false,
  useBulgarianTerms: true,
  
  maxDetailLevel: 2,
  includeFilePaths: false,
  includeLineNumbers: false,
  includeBenchmarks: false,
  
  tone: 'strategic',
  analogies: 'biological',
  
  enableBusinessImpact: true,
  enableRiskAnalysis: false,
  enableCodeGeneration: false
};

/**
 * ENGINEER PRO - Detailed Implementation Mode
 * 
 * "Ğ¤Ğ¾ĞºÑƒÑ Ğ²ÑŠÑ€Ñ…Ñƒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¸ ĞºĞ¾Ğ´Ğ¾Ğ²Ğ¸ Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ğ¸, API Ğ´ĞµÑ„Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ¸,
 *  Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²Ğµ, Ğ¿Ñ€ĞµÑ†Ğ¸Ğ·Ğ½Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¸ Ğ¿ÑŠÑ‚Ğ¸Ñ‰Ğ°."
 */
const ENGINEER_MODE: ModeConfig = {
  name: 'ENGINEER',
  fullName: 'ENGINEER PRO',
  description: 'Detailed Implementation - Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ´ĞµÑ‚Ğ°Ğ¹Ğ»Ğ¸ Ğ¸ ĞºĞ¾Ğ´',
  
  verbosity: 'detailed',
  focusAreas: [
    'code',
    'api',
    'implementation',
    'file-paths',
    'algorithms',
    'data-structures',
    'types',
    'interfaces',
    'benchmarks'
  ],
  ignoreAreas: [
    'business-impact',
    'philosophy',
    'high-level-strategy'
  ],
  
  useCodeBlocks: true,
  useDiagrams: true,
  useMetrics: true,
  useBulgarianTerms: false,
  
  maxDetailLevel: 5,
  includeFilePaths: true,
  includeLineNumbers: true,
  includeBenchmarks: true,
  
  tone: 'technical',
  analogies: 'mathematical',
  
  enableBusinessImpact: false,
  enableRiskAnalysis: false,
  enableCodeGeneration: true
};

/**
 * QA AUDITOR - Critical Verification Mode
 * 
 * "Ğ¤Ğ¾ĞºÑƒÑ Ğ²ÑŠÑ€Ñ…Ñƒ ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸, Ñ€Ğ¸ÑĞºĞ¾Ğ²Ğµ, Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¸ Ğ¿Ğ¾ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ, Ğ³Ñ€ĞµÑˆĞºĞ¸,
 *  Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ Ğ—Ğ»Ğ°Ñ‚Ğ½Ğ¸Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚, Blast Radius Ğ½Ğ° Chaos ĞµĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¸."
 */
const QA_AUDITOR_MODE: ModeConfig = {
  name: 'QA',
  fullName: 'QA AUDITOR',
  description: 'Critical Verification - Ğ Ğ¸ÑĞºĞ¾Ğ²Ğµ, Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğµ, ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸',
  
  verbosity: 'detailed',
  focusAreas: [
    'vulnerabilities',
    'risks',
    'test-coverage',
    'errors',
    'golden-standard',
    'blast-radius',
    'chaos-experiments',
    'security',
    'edge-cases',
    'regression'
  ],
  ignoreAreas: [
    'business-impact',
    'philosophy',
    'architecture-evolution'
  ],
  
  useCodeBlocks: true,
  useDiagrams: false,
  useMetrics: true,
  useBulgarianTerms: false,
  
  maxDetailLevel: 5,
  includeFilePaths: true,
  includeLineNumbers: true,
  includeBenchmarks: true,
  
  tone: 'critical',
  analogies: 'none',
  
  enableBusinessImpact: false,
  enableRiskAnalysis: true,
  enableCodeGeneration: false
};

/**
 * Mode Registry
 */
const MODES: Record<InteractionMode, ModeConfig> = {
  'ARCHITECT': ARCHITECT_MODE,
  'ENGINEER': ENGINEER_MODE,
  'QA': QA_AUDITOR_MODE
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEFAULT CONFIGURATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const DEFAULT_CONFIG: AdaptiveInterfaceConfig = {
  defaultMode: 'ARCHITECT',
  persistMode: true,
  enableModeHints: true,
  autoSwitchOnContext: false
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADAPTIVE INTERFACE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * AdaptiveInterface - The Human-AI Bridge
 * 
 * Manages dynamic switching between 3 interaction modes,
 * adapting response style and depth to Dimitar's needs.
 * 
 * @example
 * ```typescript
 * const ai = AdaptiveInterface.getInstance();
 * 
 * // Switch to architect mode for strategic discussion
 * ai.setMode('ARCHITECT');
 * const context = ai.getResponseContext();
 * // context.config.focusAreas = ['architecture', 'strategy', ...]
 * 
 * // Switch to engineer mode for coding
 * ai.setMode('ENGINEER');
 * // Now responses will include code blocks, file paths, benchmarks
 * 
 * // CLI: qantum mode set architect
 * ```
 */
export class AdaptiveInterface extends EventEmitter {
  private static instance: AdaptiveInterface;
  
  private config: AdaptiveInterfaceConfig;
  private currentMode: InteractionMode;
  private modeHistory: Array<{ mode: InteractionMode; timestamp: Date }> = [];
  
  // Neural Backpack integration
  private backpackPath: string;
  
  private constructor(config: Partial<AdaptiveInterfaceConfig> = {}) {
    super();
    this.config = { ...DEFAULT_CONFIG, ...config };
    this.backpackPath = config.backpackPath || 'data/backpack.json';
    
    // Load persisted mode
    this.currentMode = this.loadPersistedMode() || this.config.defaultMode;
    
    console.log(`ğŸ§  Adaptive Interface initialized in ${this.currentMode} mode`);
  }
  
  /**
   * Get singleton instance
   */
  static getInstance(config?: Partial<AdaptiveInterfaceConfig>): AdaptiveInterface {
    if (!AdaptiveInterface.instance) {
      AdaptiveInterface.instance = new AdaptiveInterface(config);
    }
    return AdaptiveInterface.instance;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MODE MANAGEMENT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Set interaction mode
   */
  setMode(mode: InteractionMode): void {
    const prevMode = this.currentMode;
    this.currentMode = mode;
    
    // Record in history
    this.modeHistory.push({ mode, timestamp: new Date() });
    
    // Persist if enabled
    if (this.config.persistMode) {
      this.persistMode(mode);
    }
    
    this.emit('mode:changed', { from: prevMode, to: mode });
    
    console.log(`ğŸ”„ Mode switched: ${prevMode} â†’ ${mode}`);
    this.printModeInfo(mode);
  }
  
  /**
   * Get current mode
   */
  getMode(): InteractionMode {
    return this.currentMode;
  }
  
  /**
   * Get mode configuration
   */
  getModeConfig(mode?: InteractionMode): ModeConfig {
    return MODES[mode || this.currentMode];
  }
  
  /**
   * Get all available modes
   */
  getAllModes(): Record<InteractionMode, ModeConfig> {
    return MODES;
  }
  
  /**
   * Select mode based on query analysis
   */
  selectMode(query: string): InteractionMode {
    if (!this.config.autoSwitchOnContext) {
      return this.currentMode;
    }
    
    const queryLower = query.toLowerCase();
    
    // ARCHITECT indicators
    const architectIndicators = [
      'Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°', 'architecture', 'ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ', 'strategy',
      'roadmap', 'vision', 'design', 'layer', 'philosophy',
      'evolution', 'ecosystem', 'Ğ¸Ğ¼Ğ¿Ğ°ĞºÑ‚', 'impact'
    ];
    
    // ENGINEER indicators
    const engineerIndicators = [
      'ĞºĞ¾Ğ´', 'code', 'implement', 'create', 'function', 'class',
      'interface', 'api', 'endpoint', 'file', 'method', 'variable',
      'typescript', 'javascript', 'benchmark', 'performance'
    ];
    
    // QA indicators
    const qaIndicators = [
      'test', 'Ñ‚ĞµÑÑ‚', 'bug', 'Ğ±ÑŠĞ³', 'vulnerability', 'ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚',
      'security', 'ÑĞ¸Ğ³ÑƒÑ€Ğ½Ğ¾ÑÑ‚', 'risk', 'Ñ€Ğ¸ÑĞº', 'coverage', 'Ğ¿Ğ¾ĞºÑ€Ğ¸Ñ‚Ğ¸Ğµ',
      'audit', 'verify', 'validate', 'error', 'Ğ³Ñ€ĞµÑˆĞºĞ°', 'chaos'
    ];
    
    // Count matches
    const architectScore = architectIndicators.filter(i => queryLower.includes(i)).length;
    const engineerScore = engineerIndicators.filter(i => queryLower.includes(i)).length;
    const qaScore = qaIndicators.filter(i => queryLower.includes(i)).length;
    
    // Return mode with highest score
    if (architectScore > engineerScore && architectScore > qaScore) {
      return 'ARCHITECT';
    } else if (engineerScore > architectScore && engineerScore > qaScore) {
      return 'ENGINEER';
    } else if (qaScore > architectScore && qaScore > engineerScore) {
      return 'QA';
    }
    
    return this.currentMode;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RESPONSE CONTEXT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Get context for response generation
   */
  getResponseContext(): {
    mode: InteractionMode;
    config: ModeConfig;
    systemPrompt: string;
    guidelines: string[];
  } {
    const config = this.getModeConfig();
    
    return {
      mode: this.currentMode,
      config,
      systemPrompt: this.generateSystemPrompt(config),
      guidelines: this.generateGuidelines(config)
    };
  }
  
  /**
   * Generate system prompt for current mode
   */
  private generateSystemPrompt(config: ModeConfig): string {
    const prompts: Record<InteractionMode, string> = {
      'ARCHITECT': `You are QAntum Prime operating in ARCHITECT PRIME mode.
Focus on: ${config.focusAreas.join(', ')}.
Ignore: ${config.ignoreAreas.join(', ')}.
Use biological and philosophical analogies to explain concepts.
Think strategically about system evolution and business impact.
Speak about macro-architecture, not micro-implementation.
Use Bulgarian terms naturally when appropriate.`,

      'ENGINEER': `You are QAntum Prime operating in ENGINEER PRO mode.
Focus on: ${config.focusAreas.join(', ')}.
Ignore: ${config.ignoreAreas.join(', ')}.
Provide precise file paths, line numbers, and code examples.
Include TypeScript type definitions and API signatures.
Show benchmarks and performance metrics when relevant.
Be technically precise and implementation-focused.`,

      'QA': `You are QAntum Prime operating in QA AUDITOR mode.
Focus on: ${config.focusAreas.join(', ')}.
Ignore: ${config.ignoreAreas.join(', ')}.
Identify vulnerabilities, risks, and edge cases.
Analyze test coverage and suggest improvements.
Calculate Blast Radius for changes.
Be critical and thorough - question everything.
Report deviations from the Golden Standard.`
    };
    
    return prompts[this.currentMode];
  }
  
  /**
   * Generate response guidelines for current mode
   */
  private generateGuidelines(config: ModeConfig): string[] {
    const guidelines: string[] = [];
    
    // Verbosity
    if (config.verbosity === 'minimal') {
      guidelines.push('Keep responses concise - max 3-5 sentences per point');
    } else if (config.verbosity === 'detailed') {
      guidelines.push('Provide comprehensive explanations with examples');
    }
    
    // Code blocks
    if (config.useCodeBlocks) {
      guidelines.push('Use code blocks with language hints (```typescript)');
    } else {
      guidelines.push('Avoid code blocks - describe conceptually');
    }
    
    // Diagrams
    if (config.useDiagrams) {
      guidelines.push('Include ASCII diagrams or Mermaid when helpful');
    }
    
    // Metrics
    if (config.useMetrics) {
      guidelines.push('Include quantitative metrics (%, ms, lines)');
    }
    
    // File paths
    if (config.includeFilePaths) {
      guidelines.push('Reference specific file paths (src/module/file.ts)');
    }
    
    // Line numbers
    if (config.includeLineNumbers) {
      guidelines.push('Include line numbers when referencing code');
    }
    
    // Business impact
    if (config.enableBusinessImpact) {
      guidelines.push('Discuss business impact and market value');
    }
    
    // Risk analysis
    if (config.enableRiskAnalysis) {
      guidelines.push('Highlight risks and mitigation strategies');
    }
    
    // Analogies
    if (config.analogies !== 'none') {
      guidelines.push(`Use ${config.analogies} analogies to explain concepts`);
    }
    
    return guidelines;
  }
  
  /**
   * Format response according to current mode
   */
  formatResponse(content: string): string {
    const config = this.getModeConfig();
    
    // Add mode header if hints enabled
    let formatted = '';
    if (this.config.enableModeHints) {
      formatted = `**[${config.fullName}]**\n\n`;
    }
    
    formatted += content;
    
    return formatted;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PERSISTENCE (Neural Backpack)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Load persisted mode from Neural Backpack
   */
  private loadPersistedMode(): InteractionMode | null {
    try {
      if (fs.existsSync(this.backpackPath)) {
        const data = JSON.parse(fs.readFileSync(this.backpackPath, 'utf-8'));
        if (data.adaptiveInterface?.currentMode) {
          return data.adaptiveInterface.currentMode;
        }
      }
    } catch (error) {
      // Ignore errors, use default
    }
    return null;
  }
  
  /**
   * Persist mode to Neural Backpack
   */
  private persistMode(mode: InteractionMode): void {
    try {
      let data: Record<string, unknown> = {};
      
      if (fs.existsSync(this.backpackPath)) {
        data = JSON.parse(fs.readFileSync(this.backpackPath, 'utf-8'));
      }
      
      data.adaptiveInterface = {
        currentMode: mode,
        lastChanged: new Date().toISOString(),
        modeHistory: this.modeHistory.slice(-10)
      };
      
      // Ensure directory exists
      const dir = path.dirname(this.backpackPath);
      if (!fs.existsSync(dir)) {
        fs.mkdirSync(dir, { recursive: true });
      }
      
      fs.writeFileSync(this.backpackPath, JSON.stringify(data, null, 2));
    } catch (error) {
      console.warn('Failed to persist mode:', error);
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DISPLAY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Print mode information
   */
  private printModeInfo(mode: InteractionMode): void {
    const config = MODES[mode];
    
    console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ§  ${config.fullName.padEnd(20)} - ${config.tone.toUpperCase()} MODE
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ${config.description}
â•‘
â•‘  Focus: ${config.focusAreas.slice(0, 5).join(', ')}
â•‘  Verbosity: ${config.verbosity.toUpperCase()}
â•‘  Code Blocks: ${config.useCodeBlocks ? 'âœ…' : 'âŒ'}
â•‘  Diagrams: ${config.useDiagrams ? 'âœ…' : 'âŒ'}
â•‘  Metrics: ${config.useMetrics ? 'âœ…' : 'âŒ'}
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);
  }
  
  /**
   * Get mode summary for display
   */
  getModeSummary(): string {
    const config = this.getModeConfig();
    return `[${config.fullName}] ${config.description}`;
  }
  
  /**
   * Get mode statistics
   */
  getStats(): {
    currentMode: InteractionMode;
    modeUsage: Record<InteractionMode, number>;
    lastSwitch: Date | null;
  } {
    const usage: Record<InteractionMode, number> = {
      'ARCHITECT': 0,
      'ENGINEER': 0,
      'QA': 0
    };
    
    for (const entry of this.modeHistory) {
      usage[entry.mode]++;
    }
    
    return {
      currentMode: this.currentMode,
      modeUsage: usage,
      lastSwitch: this.modeHistory.length > 0 
        ? this.modeHistory[this.modeHistory.length - 1].timestamp 
        : null
    };
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FACTORY & EXPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const getAdaptiveInterface = (
  config?: Partial<AdaptiveInterfaceConfig>
): AdaptiveInterface => {
  return AdaptiveInterface.getInstance(config);
};

export { MODES, ARCHITECT_MODE, ENGINEER_MODE, QA_AUDITOR_MODE };
export default AdaptiveInterface;
